<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workout Planner - SelecciÃ³n de rutina</title>
<style>
  body { margin:0; font-family:system-ui,sans-serif; background:#0f1724; color:#f1f5f9; display:flex; justify-content:center; align-items:center; height:100vh; }
  .app { background:#1e293b; padding:20px; border-radius:12px; width:90%; max-width:400px; text-align:center; }
  input, button, select { padding:10px; margin:5px 0; border-radius:8px; border:none; font-size:16px; width:100%; }
  button { cursor:pointer; font-weight:600; }
  button.create-btn { background:#6366f1; color:#fff; }
  button.open-btn { background:#14b8a6; color:#fff; }
</style>
</head>
<body>
<div class="app">
  <h1>ðŸ’ª Workout Planner</h1>
  
  <select id="routineSelect">
    <option value="">-- Selecciona rutina --</option>
  </select>
  <input type="text" id="newRoutine" placeholder="Nueva rutina">
  <button class="create-btn" onclick="createRoutine()">Crear nueva rutina</button>
  <button class="open-btn" onclick="openRoutine()">Abrir rutina</button>
</div>

<script>
let db;
const request = indexedDB.open("WorkoutPlannerDB",1);
request.onupgradeneeded = e => {
  db = e.target.result;
  if(!db.objectStoreNames.contains("routines")) db.createObjectStore("routines",{keyPath:"name"});
};
request.onsuccess = e => {
  db = e.target.result;
  loadRoutines();
};

function getStore(store,mode="readonly"){ return db.transaction(store,mode).objectStore(store); }

function loadRoutines(){
  const select = document.getElementById("routineSelect");
  select.innerHTML='<option value="">-- Selecciona rutina --</option>';
  const tx = getStore("routines");
  const req = tx.getAll();
  req.onsuccess = ()=>{
    req.result.forEach(r=>{
      const option = document.createElement("option");
      option.value=r.name; option.textContent=r.name;
      select.appendChild(option);
    });
  };
}

function createRoutine(){
  const name = document.getElementById("newRoutine").value.trim();
  if(!name) return alert("EscribÃ­ un nombre para la rutina");
  const tx = getStore("routines","readwrite");
  tx.put({name,created:Date.now()});
  tx.transaction.oncomplete = ()=> {
    loadRoutines();
    document.getElementById("newRoutine").value="";
    document.getElementById("routineSelect").value = name;
    openRoutine();
  };
}

function openRoutine(){
  const select = document.getElementById("routineSelect");
  const name = select.value;
  if(!name) return alert("SeleccionÃ¡ una rutina");
  // Guardamos en localStorage la rutina activa
  localStorage.setItem("activeRoutine", name);
  // Abrimos planner
  window.location.href="planner.html";
}

/* PWA service worker */
if("serviceWorker" in navigator){ navigator.serviceWorker.register("sw.js"); }
</script>
</body>
</html>
